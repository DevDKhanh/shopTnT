<header>
    <div class="nav-menu">
        <a href="/" class="nav-menu__logo">
            <img src="/img/logo.png" alt="">
        </a>
        <div class="nav-menu__items">
            <div class="menu-item line-right ">
                <a href="#">Danh mục <i class="fas fa-caret-down"></i></a>
                <div class="menu-item-drop">
                    <div class="menu-item-drop-item">
                       <a href="/danhmuc/do-cu">Đồ cũ</a> 
                    </div>
                    <div class="menu-item-drop-item">
                       <a href="/danhmuc/may-tinh-de-ban">Máy tính bàn</a> 
                    </div>
                    <div class="menu-item-drop-item">
                       <a href="/danhmuc/linh-kien-phu-kien">Phụ kiện</a> 
                    </div>
                    <div class="menu-item-drop-item">
                        <a href="/danhmuc/laptop">Laptop</a>
                    </div>
                </div>
            </div>
        </div>
        <form class="search" action="/search" method="GET">
            <input type="text" name="key" placeholder="Nhập tên sản phẩm...">
            <button><i class="fas fa-search"></i></button>
        </form>
        <div class="nav-menu__right">
            {{#if nameUser}}
            <div class="nav-menu__right-item">
                <a href="/me/order"><i class="fas fa-shipping-fast"></i></a>
                <span class="num-dot order">{{countOrder}}</span>
            </div>
            <div class="nav-menu__right-item cart-show-preview">
                <a href="/me/cart"><i class="fas fa-shopping-cart"></i></a>
                <span class="num-dot cart">{{countCart}}</span>
                <div class="preview-cart">
                    <div class="title">Sản phẩm mới thêm</div>
                    <div class="preview-list active">        
                    </div>
                    <div class="control">
                        <span class="info-quantity">1 thêm vào giỏ hàng</span>
                        <a href="/me/cart" class="btn btn-see-cart">Xem giỏ hàng</a>
                    </div>
                </div>  
            </div>
            {{#if isAdmin}}
            <div class="nav-menu__right-item">
                <a for="form-auth-check" href="/admin"><i class="fas fa-user-shield"></i></a>
            </div>
            {{/if}}
            <div class="nav-menu__right-item">
                <label for="check-logout"><i class="fas fa-sign-out-alt"></i></label>
                <div class="note-title">Đăng xuất</div>
            </div>
            {{else}}
            {{#if hide}}
            {{else}}
            <div class="nav-menu__right-item radius-3">
                <label for="form-auth-check">
                    Đăng nhập
                </label>
            </div>
            {{/if}}
            {{/if}}
        </div>
    </div>
    <div class="nav-menu nav-menu-tablet">
        <a href="/" class="nav-menu__logo">
            <img src="/img/logo.png" alt="">
        </a>
        <a href="/" class="nav-menu__logo-icon">
            <i class="fas fa-home"></i>
        </a>
        <form class="search" action="/search" method="GET">
            <input type="text" name="key" placeholder="Nhập tên sản phẩm...">
            <button><i class="fas fa-search"></i></button>
        </form>
        <div class="mobile-tab">
            <label class="tab-menu" for="nav-menu-tablet">
                <i class="fas fa-bars tab-icon"></i>
            </label>  
        </div>
        <input type="checkbox" hidden name="" class="nav-menu-tablet" id="nav-menu-tablet">
        <label for="nav-menu-tablet" class="over-lay"></label>
        <div class="main-menu-tablet">
            <div class="header-menu">
                <label class="close" for="nav-menu-tablet">&times;</label>
            </div>
            <div class="items-menu">
                <div class="item">
                    <a class="item-link" href="/danhmuc/do-cu"><i class="fas fa-desktop"></i> Đồ cũ</a>
                </div>
                <div class="item">
                    <a class="item-link" href="/danhmuc/may-tinh-de-ban"><i class="fas fa-desktop"></i> Máy tính</a>
                </div>
                <div class="item">
                    <a class="item-link" href="/danhmuc/linh-kien-phu-kien"><i class="fas fa-headphones-alt"></i> Linh kiện - Phụ kiện</a>
                </div>
                <div class="item">
                    <a class="item-link" href="/danhmuc/laptop"><i class="fas fa-laptop"></i> Laptop</a>
                </div>
                {{#if nameUser}}
                {{#if isAdmin}}
                <div class="item">
                    <a class="item-link" href="/admin"><i class="fas fa-tasks"></i> Quản lí</a>
                </div>
                {{/if}}
                <div class="item">
                    <a class="item-link" href="/me/order"><i class="fas fa-dolly"></i> Đơn hàng</a>
                </div>
                <div class="item">
                    <a class="item-link" href="/me/cart"><i class="fas fa-shopping-cart"></i> Giỏ hàng</a>
                </div>
                <div class="item">
                    <label class="item-link" for="check-logout"><i class="fas fa-sign-out-alt"></i> Đăng xuất</label>
                </div>
                {{else}}
                <div class="item">
                    <a class="item-link" href="/account/login">Đăng nhập</a>
                </div>
                <div class="item">
                    <a class="item-link" href="/account/signup">Đăng ký</a>
                </div>
                {{/if}}
            </div>
        </div>
    </div>
</header>
{{#if nameUser}}
{{else}}
{{#if hide}}
{{else}}
<input hidden type="checkbox" class="form-auth-check" id="form-auth-check">
<label class="bgr-fixed check-auth">
    <div class="form-auth">
        <label for="form-auth-check" class="close"><h2>&times;</h2></label>
        <div class="form-auth__title">
            <label class="option-auth active login" for="form-login-show"><i class="fas fa-lock-open"></i> Đăng nhập</label>
            <label class="option-auth signup" for="form-sign-show"><i class="fas fa-user-plus"></i> Đăng ký</label>
        </div>
        <div class="form-auth-option">
            <form class="form-submit-login" method="POST">
                <div class="form-group">
                    <label class="title" for="">Tên tài khoản/Gmail</label>
                    <div class="input-group">
                        <input autocomplete=off class="form-element" id="userlogin" type="text" placeholder="Nhập tên đăng nhập hoặc gmail">
                    </div>
                </div>
                <div class="form-group">
                    <label class="title" for="">Mật khẩu</label>
                    <div class="input-group">
                        <input autocomplete=off class="form-element" id="passlogin" type="password" placeholder="Nhập mật khẩu">
                    </div>
                </div>
                <div class="mt-2 mb-4">
                    <input type="checkbox" name="" id="remeber-pass"> <label style="color: #4b566b;" for="remeber-pass">Ghi nhớ mật khẩu</label>
                </div>
                <div class="form-group">
                    <div class="input-group">
                        <button class="btn form-btn btn-color-pink btn-login">Đăng nhập</button>
                    </div>
                </div>
            </form>
            <div class="text-center mt-2 mb-1"><b>Hoặc</b></div>
            <div class="form-group">
                <div class="login-social">
                    <a href="/account/facebook"  class="btn btn-social btn-handle"><i class="fab fa-facebook"></i> Đăng nhập facebook</a>
                    <a href="/account/google" class="btn btn-social btn-handle"><img src="/img/google.jpg" alt=""> Đăng nhập google</a>
                </div>
            </div>
        </div>
    </div>
</label>
{{/if}}
{{/if}}
{{#if nameUser}}
    <input hidden type="checkbox" class="check-logout" name="" id="check-logout">
    <label for="check-logout" class="overlay"></label>
    <div class="dialog-logout">
        <div class="title">Bạn chắn chắc muốn đăng xuất?</div>
        <div class="controll">
            <label for="check-logout" class="btn btn-secondary">Hủy</label>
            <a class="btn btn-danger" href="/logout">Đăng xuất</a>
        </div>
    </div>
    
<script>
    (function(){
        const API_CART = `/api/cart/me`;
        const btnShowPreview = document.querySelector('.cart-show-preview');
        const previewCart = document.querySelector('.preview-cart'); 
        const titlePreview = document.querySelector('.preview-cart .title');
        const controlPreview = document.querySelector('.preview-cart .control');
        const numPreview = document.querySelector('.preview-cart .control .info-quantity');
        

        btnShowPreview && btnShowPreview.addEventListener('mousemove', function(){
            previewCart.style.bottom = -(previewCart.offsetHeight+14)+'px';
            getDataCart(renderPreview); 
        });    

        function getDataCart(callback) {
            fetch(API_CART)
            .then(response => response.json())
            .then(callback)
        };

        function renderPreview(data) {
            let htmls = '';
            if (data.length < 1) {
                controlPreview.style.display = 'none';
                titlePreview.innerHTML='Giỏ hàng đang trống!';
                htmls = `
                    <div class="preview-empty">
                        <img src="/img/img-empty-cart.png"/>
                    </div>
                `;
            } else {
                controlPreview.style.display = 'flex';
                titlePreview.innerHTML='Sản phẩm mới thêm';
                numPreview.innerHTML=`${data.length>4?data.length-4:0} trong giỏ hàng`;
                htmls = data.map((product, index)=> {
                if (index <= 3) {
                    return `
                    <a class="preview-item" href="/seemore/${product.slug}">
                        <div class="img">
                            <img src="${product.img}" alt="">
                        </div>
                        <div class="info">
                            <div class="name-product">
                                ${product.nameProduct}
                            </div>
                            <div class="quantity">
                                <span class="price">
                                    ${product.price.toLocaleString('da-DK')} đ
                                </span>
                                X${product.quantity}
                            </div>
                        </div>
                    </a>`;
                    }
                }).join('');
            };
            $('.preview-list.active').html(htmls);
        }
        getDataCart(renderPreview); 
    })();
</script>
{{/if}}